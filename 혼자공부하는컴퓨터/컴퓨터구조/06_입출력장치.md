# 장치 컨트롤러

입출력 장치는 컴퓨터에 직접 연결되지 않고 장치 컨트롤러라는 하드웨어를 통해 연결된다.
장치 컨트롤러는 입출력 제어기, 입출력 모듈 등으로 다양하게 불리기도 한다.

장치 컨트롤러는 대표적으로 다음과 같은 역할을 통해 여러 문제들을 해결한다.

- CPU 와 입출력장치 간의 통신 중개
- 오류 검출
- 데이터 버퍼링

장치 컨트롤러 내부의 주요 기억해야 할 것엔 데이터 레지스터와 상태 레지스터, 제어 레지스터 세가지가 있다.

데이터 레지스터 : CPU 와 입출력 장치 사이에 주고받을 데이터가 담기는 레지스터
상태 레지스터 : 입출력장치가 입출력 작업을 할 준비가 되었는지, 입출력 작업이 완료되었는지, 입출력 장치에 오류는 없는지 등의 상태 정보가 저장된다.
제어 레지스터 : 입출력장치가 수행할 내용에 대한 제어 정보와 명령을 저장한다.

# 장치 드라이버

새로운 장치를 컴퓨터에 연결하려면 장치 드라이버를 설치해야 한다.
장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램이다.

장치 컨트롤러가 입출력장치를 연결하기 위한 하드웨어적인 통로라면,
장치 드라이버는 입출력장치를 연결하기 위한 소프트웨어적인 통로이다.

# 데이터 버퍼링

_버퍼링_ 이란 전송률이 높은 장치와 낮은 장치에 주고받는 데이터 버퍼를 임시 저장 공간에 저장하여 전송률을 비슷하게 맞추는 방법
=> 버퍼에 데이터를 조금씩 모았다가 한꺼번에 내보내거나, 데이터를 한 번에 많이 받아 조금씩 내보내는 방법
즉, 장치 컨트롤러는 일반적으로 전송률이 높은 CPU와 일반적으로 전송률이 낮은 입출력장치와의 전송률 차이를 데이터 버퍼링으로 완화한다.

# 메모리 맵 입출력

메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 입출력 방식

# 고립형 입출력

메모리에 접근하기 위한 주소 공간과 입출력 장치에 접근하기 위한 주소 공간을 분리하는 입출력 방식

# 인터럽트 기반 입출력

- CPU가 입출력장치에 처리할 내용을 명령하면 입출력장치가 명령어를 수행하는 동안 CPU는 다른 일을 할 수 있다.
- 입출력장치가 CPU에게 인터럽트 요청 신호를 보내면 CPU는 하던 일을 잠시 멈추고 해당 인터럽트를 처리하는 프로그램인 인터럾트 서비스 루틴을 실행한 뒤 다시 하던 일로 돌아온다.

# 폴링

인터럽트와 자주 비교되는 개념 중 폴링이라는 개념이 있다.
CPU는 주기적으로 장치 컨트롤러의 상태 레지스터를 확인하며 입출력장치의 상태를 확인한다.
이처럼 폴링이란 입출력장치의 상태는 어떤지 처리할 데이터가 있는지를 주기적으로 확인하는 방식이다.

# PIC (프로그래머블 인터럽트 컨트롤러)

여러 장치 컨트롤러에 연결되어 장치 컨트롤러에서 보낸 핟웨어 인터럽트 요청들의 우선 순위를 판별한 뒤 CPU에 지금 처리해야 할 하드 웨어 인터럽트는 무엇인지를 알려주는 장치

1. 요청 신호를 받아들인다.
2. 우선순위 판단한뒤 CPU에 처리해야 할 인터럽트 요청 신호를 보낸다.
3. CPU는 PIC에 인터럽트 확인신호를 보낸다.
4. PIC는 데이터 버스를 통해 CPI에 인터럽트 백터를 보낸다.
5. CPU는 인터럽트 백터를 통해 인터럽트 요청의 주체를 알게 되고, 해당 장치의 인터럽트 서비스 루틴을 실행한다.

# DMA

입출력장치와 메모리 사이에 전송되는 모든 데이터가 반드시 CPU를 거쳐야 한다면 가뜩이나 바쁜 CPU는 입출력장치를 위한 연산 때문에 시간을 뺏기게 된다.
그래서 입출력장치와 메모리가 CPU를 거치지 않고도 상호작용할 수 있는 입출력 방식인 DMA가 등장했다.
DMA 입출력을 하기 위해서는 시스템 버스에 연결된 DMA컨트롤러라는 하드웨어가 필요하다.

1. CPU는 DMA컨트롤러에 하드 디스크 주소, 수행할 연산(쓰기), 백업할 내용이 저장된 메모리 주소 등의 정보와 함께 입출력 작업을 명령한다.
2. DAM컨트롤러는 CPU를 거치지 않고 메모리와 직접 상호작용하며 백업할 정보를 읽어오고, 이를 하드 디스크 장치 컨트롤러에 내보낸다.

#### 시스템 버스는 동시 사용이 불가능하다. 시스템 버스는 공용 자원이기 때문이다.

CPU가 시스템 버스를 사용할 떄 DMA 컨트롤러는 시스템 버스를 사용할 수 없다.
DMA컨트롤러가 시스템 버스를 사용할 때는 CPU가 시스템 버스를 사용할 수 없다.

# 입출력버스

DMA 를 위해 시스템버스를 너무 자주 사용하면 그만큼 CPU가 시스템 버스를 이요하지 못한다. 이 문제는 DMA 컨트롤러와 장치 컨트롤러들을 *입출력 버스*라는 별도의 버스에 연결하여 해결할 수 있다.
